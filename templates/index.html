<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Motion</title>
    <!-- <script src="./srcipt.js"></script> -->
</head>
<body onload="sendData()">
    <h1>Device Motion</h1>
    <h2 id="status"></h2>
    <h2 id="x"></h2>
    <h2 id="y"></h2>
    <h2 id="z"></h2>
    <h2 id="alpha"></h2>
    <h2 id="beta"></h2>
    <h2 id="gamma"></h2>
    <p id="resp"></p>
</body>
<script>
    function sendData() { 
        xPosition=0;
        yPosition=0;

        if (window.DeviceMotionEvent == undefined) {
            //No accelerometer is present. Use buttons. 
            document.getElementById("status").innerHTML = "Accelerometer not detected";
        }
        else {
            document.getElementById("status").innerHTML = "Accelerometer detected";
            window.addEventListener("devicemotion", accelerometerUpdate, true);
        }
        
        function accelerometerUpdate(e) {
            var aX = e.accelerationIncludingGravity.x*1;
            var aY = e.accelerationIncludingGravity.y*1;
            var aZ = e.accelerationIncludingGravity.z*1;
            //The following two lines are just to calculate a
            // tilt. Not really needed. 
            xPosition = Math.atan2(aY, aZ);
            yPosition = Math.atan2(aX, aZ);
        
            document.getElementById("x").innerHTML = xPosition;
            document.getElementById("y").innerHTML = yPosition;
        
        }

        data = {'x' : xPosition, 'y' : yPosition};

        fetch('/process-data', { 
            method: 'POST', 
            headers: { 
            'Content-Type': 'application/json'
            }, 
            body: JSON.stringify({data: data}) 
        }) 
        .then(response => response.text()) 
        .then(result => { 
            console.log(result); 
        }) 
        .catch(error => { 
            console.error('Error:', error); 
        });
    }

</script>
</html>